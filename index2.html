<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>手机分享功能测试 (多种方式)</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .share-container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .share-btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: none;
            border-radius: 5px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            text-align: center;
            transition: background-color 0.3s;
        }
        .share-btn-download { background-color: #007bff; } /* 蓝色 */
        .share-btn-download:hover { background-color: #0056b3; }
        .share-btn-show-image { background-color: #28a745; } /* 绿色 */
        .share-btn-show-image:hover { background-color: #1e7e34; }
        .share-btn-mail { background-color: #6f42c1; } /* 紫色 */
        .share-btn-mail:hover { background-color: #5a32a3; }
        .share-btn-qr { background-color: #ffc107; color: #212529; } /* 黄色 */
        .share-btn-qr:hover { background-color: #e0a800; }
        .status-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }
        .status-success { background-color: #d4edda; color: #155724; }
        .status-info { background-color: #d1ecf1; color: #0c5460; }
        .status-error { background-color: #f8d7da; color: #721c24; }
        .status-warning { background-color: #fff3cd; color: #856404; }
        #generatedImage {
            max-width: 100%;
            margin-top: 20px;
            border: 1px solid #ddd;
            display: none; /* 默认隐藏 */
        }
        #qrCode {
            margin-top: 20px;
            text-align: center;
            display: none; /* 默认隐藏 */
        }
        #qrImage {
            max-width: 200px;
            height: auto;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>

<div class="share-container">
    <h1>手机分享功能测试 (多种方式)</h1>
    <p>尝试多种方式触发手机浏览器分享功能</p>

    <button id="downloadFileBtn" class="share-btn share-btn-download">生成并下载文件 (触发分享?)</button>
    <button id="showImageBtn" class="share-btn share-btn-show-image">生成图片并显示 (长按分享?)</button>
    <button id="mailBtn" class="share-btn share-btn-mail">发送邮件</button>
    <button id="generateQRBtn" class="share-btn share-btn-qr">生成二维码分享</button>

    <div id="statusMessage" class="status-message"></div>
    <img id="generatedImage" alt="生成的分享图片" />
    <div id="qrCode">
        <p>扫描下方二维码分享：</p>
        <img id="qrImage" alt="二维码" style="display: none;" />
    </div>
</div>

<script>
    const statusDiv = document.getElementById('statusMessage');
    const generatedImage = document.getElementById('generatedImage');
    const qrDiv = document.getElementById('qrCode');
    const qrImage = document.getElementById('qrImage');

    function showStatus(message, type) {
        statusDiv.textContent = message;
        statusDiv.className = 'status-message status-' + type;
        statusDiv.style.display = 'block';

        // 3秒后自动隐藏状态信息
        setTimeout(() => {
            statusDiv.style.display = 'none';
        }, 3000);
    }

    function hideAllGeneratedContent() {
        generatedImage.style.display = 'none';
        qrDiv.style.display = 'none';
        qrImage.style.display = 'none';
        qrImage.src = ''; // 清空图片源
    }

    function showQR(url) {
        qrImage.src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(url)}`;
        qrImage.style.display = 'block';
        qrDiv.style.display = 'block';
    }

    // 模拟生成一个简单的文本内容
    function generateTextContent() {
        return `这是一段分享的文字内容。

时间: ${new Date().toLocaleString()}
链接: https://www.example.com

快来查看吧！`;
    }

    // 模拟生成一个简单的图片 Blob (用于下载和显示)
    async function generateImageBlob() {
        const canvas = document.createElement('canvas');
        canvas.width = 300;
        canvas.height = 200;
        const ctx = canvas.getContext('2d');

        // 背景
        ctx.fillStyle = '#f0f8ff';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // 文字
        ctx.fillStyle = '#333';
        ctx.font = '16px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('分享图片示例', canvas.width / 2, canvas.height / 2 - 10);

        ctx.font = '12px Arial';
        ctx.fillText('生成时间: ' + new Date().toLocaleString(), canvas.width / 2, canvas.height / 2 + 20);

        // 边框
        ctx.strokeStyle = '#000';
        ctx.lineWidth = 2;
        ctx.strokeRect(0, 0, canvas.width, canvas.height);

        return new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
    }


    // ===== 按钮 1: 生成并下载文件 =====
    document.getElementById('downloadFileBtn').addEventListener('click', async () => {
        console.log('点击了 "生成并下载文件" 按钮');
        showStatus('正在生成文件...', 'info');
        hideAllGeneratedContent(); // 隐藏其他内容

        try {
            // 生成文本内容
            const content = generateTextContent();
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);

            // 创建下载链接
            const a = document.createElement('a');
            a.href = url;
            a.download = `分享内容_${new Date().toISOString().replace(/[:.]/g, '-').slice(0, 19)}.txt`;

            // 触发下载
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);

            // 释放 URL 对象
            URL.revokeObjectURL(url);

            showStatus('✅ 文件已下载！\n部分手机浏览器下载后会显示分享按钮。', 'success');
        } catch (error) {
            console.error('下载文件失败:', error);
            showStatus(`❌ 下载文件失败: ${error.message || error}`, 'error');
        }
    });

    // ===== 按钮 2: 生成图片并显示 =====
    document.getElementById('showImageBtn').addEventListener('click', async () => {
        console.log('点击了 "生成图片并显示" 按钮');
        showStatus('正在生成图片...', 'info');
        hideAllGeneratedContent(); // 隐藏其他内容

        try {
            const blob = await generateImageBlob();
            if (!blob) {
                 throw new Error('Canvas toBlob failed, returned null.');
            }
            const url = URL.createObjectURL(blob);

            generatedImage.src = url;
            generatedImage.style.display = 'block';

            showStatus('✅ 图片已生成！\n请长按图片，选择“分享”或“保存到相册”后分享。', 'success');
        } catch (error) {
            console.error('生成图片失败:', error);
            showStatus(`❌ 生成图片失败: ${error.message || error}`, 'error');
        }
    });

    // ===== 按钮 3: 发送邮件 =====
    document.getElementById('mailBtn').addEventListener('click', () => {
        console.log('点击了 "发送邮件" 按钮');
        hideAllGeneratedContent(); // 隐藏其他内容

        const subject = encodeURIComponent('分享链接');
        const body = encodeURIComponent(`快来看这个链接！\n\nhttps://www.example.com\n\n时间: ${new Date().toLocaleString()}`);
        const mailtoLink = `mailto:?subject=${subject}&body=${body}`;

        // 直接打开 mailto 链接
        window.location.href = mailtoLink;

        showStatus('正在尝试启动邮件应用...', 'info');
        // 注意：浏览器通常不允许在非用户交互（如 setTimeout）之外打开 mailto 链接，这里直接点击是允许的
    });

    // ===== 按钮 4: 生成二维码 =====
    document.getElementById('generateQRBtn').addEventListener('click', () => {
        console.log('点击了 "生成二维码" 按钮');
        hideAllGeneratedContent(); // 隐藏其他内容

        const urlToShare = 'https://www.example.com'; // 你想分享的 URL
        showQR(urlToShare);
        showStatus('二维码已生成！\n请使用微信、支付宝等扫码工具扫描。', 'info');
    });

    // 页面加载提示
    window.addEventListener('load', () => {
        showStatus('页面已加载。请尝试上方按钮。', 'info');
    });

</script>

</body>
</html>
